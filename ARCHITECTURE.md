# ğŸ—ï¸ Arquitetura TÃ©cnica - VolleyScore Pro v2

## ğŸ”„ FLUXO GERAL DA APLICAÃ‡ÃƒO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VOLLEYSCORE PRO V2                           â”‚
â”‚                    React 19 + Vite + Firebase                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         APP.TSX (Main Component)        â”‚
         â”‚                                         â”‚
         â”‚  â€¢ GameState (Zustand + Context)        â”‚
         â”‚  â€¢ SyncRole (host/spectator/local)      â”‚
         â”‚  â€¢ SessionID (6-digit code)             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CONTROLSâ”‚          â”‚ MODALS  â”‚          â”‚ SETTINGS â”‚
    â”‚ & COURT â”‚          â”‚ MANAGER â”‚          â”‚ & SYSTEM â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â”‚                     â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      SERVICES LAYER (Backend)           â”‚
         â”‚                                         â”‚
         â”‚  â€¢ SyncEngine.ts (VolleyLink Live)     â”‚
         â”‚  â€¢ SyncService.ts (Cloud Sync)         â”‚
         â”‚  â€¢ BackupService.ts (Import/Export)    â”‚
         â”‚  â€¢ AuthContext.tsx (Google OAuth)      â”‚
         â”‚  â€¢ FirebaseService.ts (Firestore)      â”‚
         â”‚  â€¢ SecureStorage.ts (LocalStorage)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  FIRESTORE   â”‚  â”‚   BROWSER    â”‚  â”‚  DEVICE OS   â”‚
    â”‚  (Cloud)     â”‚  â”‚ LocalStorage â”‚  â”‚ (Capacitor)  â”‚
    â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
    â”‚ â€¢ live_match â”‚  â”‚ â€¢ sync_queue â”‚  â”‚ â€¢ Haptics    â”‚
    â”‚ â€¢ users/uid/ â”‚  â”‚ â€¢ game_state â”‚  â”‚ â€¢ Storage    â”‚
    â”‚ â€¢ profiles   â”‚  â”‚ â€¢ logs       â”‚  â”‚ â€¢ Audio      â”‚
    â”‚ â€¢ matches    â”‚  â”‚ â€¢ backup     â”‚  â”‚ â€¢ Orientationâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” VOLLEY LINK LIVE - ARQUITETURA DETALHADA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REAL-TIME BROADCASTING                    â”‚
â”‚                                                              â”‚
â”‚  DEVICE A (HOST)          FIRESTORE         DEVICE B (SPEC) â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                              â”‚
â”‚  User Action                                                â”‚
â”‚  Clique "Broadcast"       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â•‘                        â”‚ Generate Codeâ”‚                 â”‚
â”‚  â•‘ generateCode()         â”‚ Ex: 542871   â”‚                 â”‚
â”‚  â•‘                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚  â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ SyncEngine.hostM   â”‚â”€â”€â”€ Create Doc â”€â”€â”€â”€â–º live_matches  â”‚
â”‚  â”‚ atch()             â”‚                     /542871        â”‚
â”‚  â”‚ â”œâ”€ sessionId       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ â”œâ”€ initialState    â”‚  â”‚ hostUid      â”‚                 â”‚
â”‚  â”‚ â””â”€ auth            â”‚  â”‚ status       â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ connectedCnt â”‚                 â”‚
â”‚                          â”‚ state (whole)â”‚                 â”‚
â”‚  (Scores, Serves, etc)   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚  â•‘                                                         â”‚
â”‚  â•‘ broadcastState()                                        â”‚
â”‚  â•‘ â”œâ”€ Debounce 100ms         LISTEN onSnapshot            â”‚
â”‚  â•‘ â”œâ”€ Sanitize                             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â•‘ â””â”€ Persist offline  â”€â”€â”€â”€â–º offline queue  â”‚            â”‚
â”‚  â•‘                                          â”‚            â”‚
â”‚  â–¼                                          â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Update Doc  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ User Adds Point    â”‚  live_matchesâ”‚ Real-time    â”‚   â”‚
â”‚  â”‚ â”œâ”€ addPoint(A)     â”‚ /542871.state   â”‚ Update    â”‚   â”‚
â”‚  â”‚ â”œâ”€ dispatch POINT  â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Real-time    â”‚   â”‚
â”‚  â”‚ â””â”€ broadcastState()â”‚                 â”‚           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Score A: 15   â–¼           â”‚   â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  OfflineQueue                         â”‚ Spectator    â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ Sees Update  â”‚   â”‚
â”‚  â”‚ If offline:     â”‚                  â”‚ Score A: 15  â”‚   â”‚
â”‚  â”‚ â”œâ”€ Queue action â”‚                  â”‚ Auto-refresh â”‚   â”‚
â”‚  â”‚ â”œâ”€ Persist LStorâ”‚                  â”‚ UI           â”‚   â”‚
â”‚  â”‚ â””â”€ onOnline()   â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚    flushQueue() â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FIRESTORE STRUCTURE:
live_matches/{sessionId}
â”œâ”€ hostUid: "user123"
â”œâ”€ status: "active"
â”œâ”€ connectedCount: 2
â”œâ”€ lastUpdate: timestamp
â””â”€ state: {
   scoreA: 15,
   scoreB: 10,
   servingTeam: "A",
   ...fullGameState
}
```

---

## â˜ï¸ CLOUD SYNC - ARQUITETURA DETALHADA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLOUD SYNCHRONIZATION                     â”‚
â”‚                                                              â”‚
â”‚  DEVICE A                FIREBASE            DEVICE B       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  Login com Google                                            â”‚
â”‚  â•‘ signInWithGoogle()   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â•‘ â”œâ”€ popup/redirect    â”‚ Google OAuth â”‚                   â”‚
â”‚  â•‘ â””â”€ getRedirectResult â”‚ getToken()   â”‚                   â”‚
â”‚  â–¼                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ User Authenticated â”‚â”€â”€â”€â”€ persistIdToken â”€â”€â–º auth state  â”‚
â”‚  â”‚ uid = "user123"    â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      (auto-renew)                  â”‚
â”‚                                                             â”‚
â”‚  Click "Cloud Sync"           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â•‘ handleCloudSync()           â”‚ Firestore    â”‚            â”‚
â”‚  â•‘                             â”‚ Sec Rules    â”‚            â”‚
â”‚  â•‘ Step 1: PULL REMOTE         â”‚              â”‚            â”‚
â”‚  â•‘ pullMatches(uid)   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ users/uid/   â”‚            â”‚
â”‚  â•‘  â”œâ”€ collection(matches)    â”‚ matches/     â”‚            â”‚
â”‚  â•‘  â”œâ”€ limit(100)             â”‚ â”œâ”€ match1    â”‚            â”‚
â”‚  â•‘  â”œâ”€ orderBy(timestamp)     â”‚ â”œâ”€ match2    â”‚            â”‚
â”‚  â•‘  â””â”€ getDocs()              â”‚ â””â”€ match3    â”‚            â”‚
â”‚  â”‚                             â”‚              â”‚            â”‚
â”‚  â–¼ [Match[], Profile[]]        â”‚              â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚              â”‚            â”‚
â”‚  â”‚ Merge Local        â”‚       â”‚              â”‚            â”‚
â”‚  â”‚ + Remote          â”‚       â”‚              â”‚            â”‚
â”‚  â”œâ”€ By ID (no dups)  â”‚       â”‚              â”‚            â”‚
â”‚  â”œâ”€ By timestamp     â”‚       â”‚              â”‚            â”‚
â”‚  â””â”€ historyStore()   â”‚       â”‚              â”‚            â”‚
â”‚                       â”‚       â”‚              â”‚            â”‚
â”‚  Step 2: PUSH LOCAL  â”‚       â”‚              â”‚            â”‚
â”‚  â•‘ pushProfiles(uid) â”œâ”€â”€â”€â”€â”€â”€â†’ users/uid/    â”‚            â”‚
â”‚  â•‘  â”œâ”€ Array profiles â”‚       profiles/     â”‚            â”‚
â”‚  â•‘  â”œâ”€ writeBatch()   â”‚       â”œâ”€ profile1   â”‚            â”‚
â”‚  â•‘  â”œâ”€ merge: true    â”‚       â”œâ”€ profile2   â”‚            â”‚
â”‚  â•‘  â””â”€ commit()       â”‚       â””â”€ profile3   â”‚            â”‚
â”‚  â”‚ [ServerTimestamp]  â”‚       [lastSynced]  â”‚            â”‚
â”‚  â–¼                    â”‚                      â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Status: "Synced!" â”‚       â”‚ Device B:    â”‚            â”‚
â”‚  â”‚ Checkmark âœ“       â”‚ â—„â”€ Cloud Sync same â”€â”¤ pulls/push â”‚
â”‚  â”‚ (toast notif)     â”‚       â”‚ merges data  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ Status OK    â”‚            â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â”‚ FIRESTORE COLLECTIONS:                                  â”‚
â”‚ /users/{uid}/                                           â”‚
â”‚  â”œâ”€ profiles/  (PlayerProfile[])                       â”‚
â”‚  â””â”€ matches/   (Match[])                               â”‚
â”‚                                                         â”‚
â”‚ SECURITY RULES:                                        â”‚
â”‚ allow read, write:                                     â”‚
â”‚   if request.auth.uid == {uid}                        â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ BACKUP LOCAL - ARQUITETURA DETALHADA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LOCAL BACKUP & RESTORE                      â”‚
â”‚                                                              â”‚
â”‚  EXPORT PATH                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                              â”‚
â”‚  Click "Generate Backup"                                   â”‚
â”‚  â•‘ handleGenerateBackup()                                 â”‚
â”‚  â•‘ â”œâ”€ SecureStorage.load(KEY_HISTORY)                    â”‚
â”‚  â•‘ â”œâ”€ SecureStorage.load(KEY_PROFILES)                   â”‚
â”‚  â•‘ â”œâ”€ SecureStorage.load(KEY_GAME_STATE)                 â”‚
â”‚  â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ BackupService.generateBackup() â”‚                      â”‚
â”‚  â”‚                                â”‚                       â”‚
â”‚  â”‚ Schema = {                     â”‚                       â”‚
â”‚  â”‚   meta: {                      â”‚                       â”‚
â”‚  â”‚     version: "2.0.0",          â”‚                       â”‚
â”‚  â”‚     appVersion: "2.0.6",       â”‚                       â”‚
â”‚  â”‚     timestamp: 1735550400000,  â”‚                       â”‚
â”‚  â”‚     platform: "Mozilla/5.0..." â”‚                       â”‚
â”‚  â”‚   },                           â”‚                       â”‚
â”‚  â”‚   data: {                      â”‚                       â”‚
â”‚  â”‚     history: [Match[]],        â”‚                       â”‚
â”‚  â”‚     profiles: [Profile[]],     â”‚                       â”‚
â”‚  â”‚     gameState: {...}           â”‚                       â”‚
â”‚  â”‚   }                            â”‚                       â”‚
â”‚  â”‚ }                              â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚       â”‚                                                   â”‚
â”‚       â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ downloadJSON()                 â”‚                      â”‚
â”‚  â”‚                                â”‚                      â”‚
â”‚  â”‚ filename = "volleyscore_       â”‚                      â”‚
â”‚  â”‚   backup_2025-12-30.json"      â”‚                      â”‚
â”‚  â”‚                                â”‚                      â”‚
â”‚  â”‚ navigator.download()           â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚       â”‚                                                   â”‚
â”‚       â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ File baixado (Downloads/)      â”‚                      â”‚
â”‚  â”‚ Status: "Success âœ“"            â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                          â”‚
â”‚  RESTORE PATH                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚                                                          â”‚
â”‚  Click "Restore Backup"                                â”‚
â”‚  â•‘ handleRestoreClick()                               â”‚
â”‚  â•‘ â†’ fileInputRef.click() [hidden input]             â”‚
â”‚  â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ User selects JSON file         â”‚                  â”‚
â”‚  â”‚ onChange â†’ handleFileChange()  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                                               â”‚
â”‚       â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ parseJSONFile(file)            â”‚                  â”‚
â”‚  â”‚ â”œâ”€ FileReader.readAsText()     â”‚                  â”‚
â”‚  â”‚ â”œâ”€ JSON.parse()                â”‚                  â”‚
â”‚  â”‚ â””â”€ try/catch error handling    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                                               â”‚
â”‚       â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ BackupService.restoreBackup()  â”‚                  â”‚
â”‚  â”‚                                â”‚                  â”‚
â”‚  â”‚ Validations:                   â”‚                  â”‚
â”‚  â”‚ â”œâ”€ rawJson != null             â”‚                  â”‚
â”‚  â”‚ â”œâ”€ rawJson.meta exists         â”‚                  â”‚
â”‚  â”‚ â”œâ”€ rawJson.data exists         â”‚                  â”‚
â”‚  â”‚ â””â”€ throw error if invalid      â”‚                  â”‚
â”‚  â”‚                                â”‚                  â”‚
â”‚  â”‚ Atomic Operations:             â”‚                  â”‚
â”‚  â”‚ â”œâ”€ SecureStorage.save(history) â”‚                  â”‚
â”‚  â”‚ â”œâ”€ SecureStorage.save(profiles)â”‚                  â”‚
â”‚  â”‚ â”œâ”€ SecureStorage.save(gameState)                  â”‚
â”‚  â”‚ â”œâ”€ Promise.all([...])          â”‚                  â”‚
â”‚  â”‚ â””â”€ All or Nothing              â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                                               â”‚
â”‚       â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ window.location.reload()       â”‚                  â”‚
â”‚  â”‚                                â”‚                  â”‚
â”‚  â”‚ App reloads, carrega dados:    â”‚                  â”‚
â”‚  â”‚ â”œâ”€ useVolleyGame hook         â”‚                  â”‚
â”‚  â”‚ â”œâ”€ historyStore carrega       â”‚                  â”‚
â”‚  â”‚ â”œâ”€ rosterStore carrega        â”‚                  â”‚
â”‚  â”‚ â””â”€ GameState refill           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                                               â”‚
â”‚       â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Status: "Restored âœ“"           â”‚                  â”‚
â”‚  â”‚ Todos os dados de volta        â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± INTEGRAÃ‡ÃƒO COM DISPOSITIVOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MULTI-DEVICE ARCHITECTURE                   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WEB/PWA    â”‚    â”‚   ANDROID   â”‚    â”‚    iOS     â”‚  â”‚
â”‚  â”‚ Chrome/FF  â”‚    â”‚ App (native)â”‚    â”‚ Safari/App â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                   â”‚                    â”‚       â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                            â”‚                            â”‚
â”‚                            â–¼                            â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                â”‚  Capacitor Runtime   â”‚                â”‚
â”‚                â”‚ (Web View + Native)  â”‚                â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                            â”‚                            â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚        â”‚                   â”‚                   â”‚       â”‚
â”‚        â–¼                   â–¼                   â–¼       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ Storageâ”‚          â”‚ Hapticsâ”‚          â”‚ Audioâ”‚  â”‚
â”‚    â”‚  API   â”‚          â”‚  API   â”‚          â”‚ API  â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚  All platforms share same codebase (React) â”‚   â”‚
â”‚    â”‚  Single build â†’ Web, Android, iOS          â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ STATE MANAGEMENT FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ZUSTAND + CONTEXT ARCHITECTURE             â”‚
â”‚                                                         â”‚
â”‚  Action User          React Component                  â”‚
â”‚  (Click Button)       (ModalManager, Controls, etc)    â”‚
â”‚        â”‚                          â”‚                    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                   â”‚                                    â”‚
â”‚                   â–¼                                    â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚          â”‚ useVolleyGame()â”‚                           â”‚
â”‚          â”‚ (Custom Hook)  â”‚                           â”‚
â”‚          â”‚                â”‚                           â”‚
â”‚          â”‚ â”œâ”€ dispatch()  â”‚                           â”‚
â”‚          â”‚ â”œâ”€ addPoint()  â”‚                           â”‚
â”‚          â”‚ â”œâ”€ setServer() â”‚                           â”‚
â”‚          â”‚ â””â”€ actions...  â”‚                           â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                   â”‚                                    â”‚
â”‚                   â–¼                                    â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚          â”‚ gameReducer    â”‚                           â”‚
â”‚          â”‚ (src/reducers) â”‚                           â”‚
â”‚          â”‚                â”‚                           â”‚
â”‚          â”‚ action: POINT  â”‚                           â”‚
â”‚          â”‚  â†’ new state   â”‚                           â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                   â”‚                                    â”‚
â”‚                   â–¼                                    â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚          â”‚  GameContext   â”‚                           â”‚
â”‚          â”‚  (Provider)    â”‚                           â”‚
â”‚          â”‚                â”‚                           â”‚
â”‚          â”‚ state:         â”‚                           â”‚
â”‚          â”‚ â”œâ”€ scoreA      â”‚                           â”‚
â”‚          â”‚ â”œâ”€ scoreB      â”‚                           â”‚
â”‚          â”‚ â”œâ”€ syncRole    â”‚                           â”‚
â”‚          â”‚ â”œâ”€ sessionId   â”‚                           â”‚
â”‚          â”‚ â””â”€ ...         â”‚                           â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                   â”‚                                    â”‚
â”‚                   â–¼                                    â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚      â”‚  useRoster()           â”‚                      â”‚
â”‚      â”‚  historyStore (Zustand)â”‚                      â”‚
â”‚      â”‚  (Global Player Data)  â”‚                      â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                   â”‚                                    â”‚
â”‚                   â–¼                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ UI Rerender (Memoized Comps)  â”‚                 â”‚
â”‚   â”‚ (RecordedVictor: React.memo)  â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                   â”‚                                    â”‚
â”‚                   â–¼                                    â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚      â”‚ Side Effects           â”‚                      â”‚
â”‚      â”‚ (useEffect hooks)      â”‚                      â”‚
â”‚      â”‚                        â”‚                      â”‚
â”‚      â”‚ â”œâ”€ Haptics feedback   â”‚                      â”‚
â”‚      â”‚ â”œâ”€ Audio playback     â”‚                      â”‚
â”‚      â”‚ â”œâ”€ Broadcast sync     â”‚                      â”‚
â”‚      â”‚ â”œâ”€ LocalStorage save  â”‚                      â”‚
â”‚      â”‚ â””â”€ History update     â”‚                      â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¬ REQUEST/RESPONSE CYCLE - VolleyLink Live

```
T0   Host User clicks "Score A"
     â”‚
     â–¼ T1
     React onClick â†’ addPoint('A')
     â”‚
     â–¼ T2
     dispatch({ type: 'POINT', team: 'A' })
     â”‚
     â–¼ T3
     gameReducer: scoreA++
     â”‚
     â–¼ T4
     GameContext updates state
     â”‚
     â–¼ T5
     Components re-render
     â”œâ”€ Score card: 15 â†’ 16
     â””â”€ Animations trigger
     â”‚
     â–¼ T6 (useEffect)
     SyncEngine.broadcastState(sessionId, state)
     â”‚
     â–¼ T7
     Firebase updateDoc(live_matches/{id}.state)
     â”‚
     â–¼ T8
     Firestore saves & triggers listeners
     â”‚
     â–¼ T9
     Spectator receives onSnapshot update
     â”‚
     â–¼ T10
     setState({ type: 'LOAD_STATE', payload: remoteState })
     â”‚
     â–¼ T11
     Spectator's scoreA: 15 â†’ 16
     â”‚
     â–¼ T12
     Spectator component re-renders
     â”‚
     â–¼ T13
     Spectator sees score update
     â””â”€ Total latency: ~50-100ms

OFFLINE SCENARIO:
â”€ If Host goes offline at T7:
  1. broadcastState() fails
  2. pendingState = state
  3. Persist to SecureStorage
  4. When online: flushQueue() triggers
  5. Updates sent to Firestore
  6. Spectators get update
```

---

## ğŸ” SECURITY LAYERS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          SECURITY ARCHITECTURE                          â”‚
â”‚                                                         â”‚
â”‚  LAYER 1: Authentication                              â”‚
â”‚  â”œâ”€ Google OAuth 2.0                                 â”‚
â”‚  â”œâ”€ Firebase Auth (auto token refresh)               â”‚
â”‚  â””â”€ getRedirectResult() for mobile                   â”‚
â”‚                                                       â”‚
â”‚  LAYER 2: Firestore Rules                            â”‚
â”‚  â”œâ”€ /users/{uid}/... â†’ check auth.uid == uid        â”‚
â”‚  â”œâ”€ /live_matches/{id} â†’ check hostUid              â”‚
â”‚  â””â”€ Compile-time validation                          â”‚
â”‚                                                       â”‚
â”‚  LAYER 3: Data Sanitization                          â”‚
â”‚  â”œâ”€ JSON.parse(JSON.stringify(state))               â”‚
â”‚  â”‚  (Remove circular refs)                           â”‚
â”‚  â”œâ”€ InputSanitize for player names                  â”‚
â”‚  â””â”€ XSS prevention (React escapes JSX)              â”‚
â”‚                                                       â”‚
â”‚  LAYER 4: Local Storage                              â”‚
â”‚  â”œâ”€ SecureStorage wrapper                           â”‚
â”‚  â”œâ”€ Try/catch for quota exceeded                    â”‚
â”‚  â”œâ”€ Redundant backup keys                           â”‚
â”‚  â””â”€ Auto-recovery on failure                        â”‚
â”‚                                                       â”‚
â”‚  LAYER 5: Transport                                  â”‚
â”‚  â”œâ”€ HTTPS only (Firebase enforced)                  â”‚
â”‚  â”œâ”€ TLS 1.2+ encryption                             â”‚
â”‚  â””â”€ JWT token auto-refresh                          â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Architecture Diagrams v2.0.6**  
Last Updated: 2025-12-30
