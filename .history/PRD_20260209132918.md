PRD: Lote 3 - Modos de Jogo Dinâmicos (2v2 a 6v6)
Documento de Requisitos de Produto
Versão: 1.0
Data: 2026-02-09
Status: Aguardando Aprovação

1. Contexto
Situação Atual
O VolleyScore Pro atualmente suporta apenas dois modos de jogo fixos:

Indoor (6v6): 6 jogadores em quadra, 6 reservas
Beach (4v4/2v2): 4 jogadores em quadra, 3 reservas
Os limites estão hardcoded em múltiplos arquivos, dificultando a extensão para outros formatos populares como 3v3 (Triples) ou 5v5.

Objetivo da Refatoração
Migrar de presets fixos para um motor de jogo parametrizado que suporte qualquer configuração de jogadores (2v2, 3v3, 4v4, 5v5, 6v6) de forma dinâmica, adaptando automaticamente:

Limite de jogadores em quadra
Limite do banco de reservas
Layout visual da quadra (posições)
Lógica de substituição e validação
2. Descobertas da Pesquisa
2.1 Limites Hardcoded Encontrados
Arquivo	Linha	Valor	Problema
src/constants.ts	35-40	6, 4, 6, 3	Constantes centralizadas, mas binário (indoor/beach)
src/utils/rosterLogic.ts	8	BENCH_LIMIT = 6	CRÍTICO: Constante local, ignora modo beach
src/components/TeamManager/TeamColumn.tsx	95-96	>= 6	CRÍTICO: Comparação hardcoded
src/constants.ts	49-50	6, 6	Constantes legacy não usadas
2.2 Sistema de Posicionamento da Quadra
Estrutura atual (VolleyballCourt.tsx):


ZONE_MAP_INDOOR = [1, 6, 5, 4, 3, 2]  // 6 posições
ZONE_MAP_BEACH  = [1, 4, 3, 2]        // 4 posições
Usa CSS Grid 2 colunas com rows dinâmicas (3 para indoor, 2 para beach)
gridOrder arrays reordenam visualmente por lado (esquerda/direita)
Índice 0 do array = Posição do sacador (Zona 1) - sempre
Rotações operam no nível do array, não das zonas
2.3 Lógica de Substituição e Roubo
Sem validação de time completo - apenas UI desabilita botões
Substituições são trocas 1:1 mecânicas
"Steal/Roubo" só ocorre durante rotação de times da fila
Flag isFixed protege jogadores de serem movidos/roubados
Nenhuma função isTeamComplete() existe
3. Arquivos Afetados
3.1 Novos Arquivos a Criar
Arquivo	Propósito
src/config/gameModes.ts	Registro central de configurações de modo
src/utils/validation.ts	Validação de times e partidas
3.2 Arquivos de Tipos
Arquivo	Mudança
src/types/domain.ts	Adicionar GameModeConfig, CourtLayoutConfig
3.3 Arquivos de Configuração
Arquivo	Mudança
src/constants.ts	Refatorar helpers para usar novo sistema
3.4 Arquivos de Estado
Arquivo	Mudança
src/reducers/meta.ts	Usar modeConfig para redistribuição
src/reducers/roster.ts	Passar courtLimit do modeConfig
src/contexts/GameContext.tsx	Expor modeConfig aos componentes
3.5 Arquivos de Utilidades
Arquivo	Mudança
src/utils/rosterLogic.ts:8	Remover BENCH_LIMIT = 6 local
src/utils/balanceUtils.ts	Já parametrizado, sem mudanças
src/utils/gameLogic.ts	Já funciona com qualquer tamanho de array
3.6 Componentes de UI
Arquivo	Mudança
src/components/Court/VolleyballCourt.tsx	Consumir CourtLayoutConfig dinâmico
src/components/modals/CourtModal.tsx	Passar config para quadra
src/components/TeamManager/TeamColumn.tsx:95-96	Usar prop maxPlayers
src/components/TeamManager/PlayerContextMenu.tsx:94	Usar contexto/prop
src/components/modals/SubstitutionModal.tsx	Adicionar validação mínima
src/components/Settings/MatchTab.tsx	Seletor de modo com opções de jogadores
4. Plano de Ação
Fase 1: Fundação (Não-Destrutivo)
4.1.1 Criar Interface GameModeConfig


// src/types/domain.ts

export interface CourtLayoutConfig {
  playersOnCourt: number;      // 2, 3, 4, 5, ou 6
  benchLimit: number;          // Limite de reservas
  gridRows: number;            // Rows do CSS Grid (1, 2, ou 3)
  gridCols: number;            // Sempre 2 (frente/fundo)
  zoneMap: number[];           // Números das zonas visuais
  gridOrderLeft: number[];     // Ordem de índices para lado esquerdo
  gridOrderRight: number[];    // Ordem de índices para lado direito
}

export interface GameModeConfig {
  type: GameModeType;
  label: string;
  courtLayout: CourtLayoutConfig;
  defaultScoringRules: ScoringRules;
}
4.1.2 Criar Registro de Presets


// src/config/gameModes.ts

GAME_MODE_PRESETS = {
  'indoor-6v6': { playersOnCourt: 6, benchLimit: 6, gridRows: 3, ... },
  'beach-4v4':  { playersOnCourt: 4, benchLimit: 3, gridRows: 2, ... },
  'beach-2v2':  { playersOnCourt: 2, benchLimit: 1, gridRows: 1, ... },
  'triples-3v3':{ playersOnCourt: 3, benchLimit: 2, gridRows: 2, ... },
  'quads-5v5':  { playersOnCourt: 5, benchLimit: 4, gridRows: 3, ... },
}
Fase 2: Estratégia de Posições Visuais
4.2.1 Mapeamento de Grid por Número de Jogadores

Jogadores	Grid	Padrão Visual
2	1x2	[Sacador] [Parceiro]
3	2x2	[Frente] [Sacador] / [Vazio] [Fundo] (Triângulo)
4	2x2	[FE] [FD] / [TE] [TD]
5	3x2	[FE] [FD] / [ME] [MD] / [Vazio] [Sacador]
6	3x2	Layout padrão 6 posições
4.2.2 Algoritmo de ZoneMap Dinâmico


2 jogadores: [1, 2]           // Sacador + Parceiro
3 jogadores: [1, 3, 2]        // Triângulo
4 jogadores: [1, 4, 3, 2]     // Beach padrão
5 jogadores: [1, 5, 4, 3, 2]  // Sem zona 6
6 jogadores: [1, 6, 5, 4, 3, 2] // Indoor padrão
4.2.3 Slots Vazios

Usar -1 em gridOrder para indicar posição vazia
Renderizar como célula transparente ou placeholder
Fase 3: Regras de Validação
4.3.1 Validação de Time para Partida


validateTeamForMatch(team, modeConfig) {
  - Erro se team.players.length < playersOnCourt
  - Warning se reserves.length > benchLimit
  - Warning se reserves.length === 0 (sem substitutos)
}
4.3.2 Validação de Início de Partida


validateMatchStart(teamA, teamB, modeConfig) {
  - Ambos os times devem ter >= playersOnCourt jogadores
  - Retornar razão específica se falhar
}
4.3.3 Validação de Roubo/Empréstimo

Time completo = team.players.length === playersOnCourt
Roubo só preenche até playersOnCourt, não 6 fixo
Fase 4: Integração de Estado
4.4.1 Atualizar GameConfig


export interface GameConfig {
  mode: GameModeType;
  modeConfig: GameModeConfig;  // NOVO
  // ... campos existentes
}
4.4.2 Backward Compatibility


// Em constants.ts - manter funções existentes funcionando
getPlayersOnCourt(mode, playersOnCourt?) {
  const config = getGameModeConfig(mode, playersOnCourt);
  return config.courtLayout.playersOnCourt;
}
Fase 5: Adaptação de UI
4.5.1 VolleyballCourt

Receber layoutConfig: CourtLayoutConfig como prop
Usar zoneMap, gridOrderLeft, gridOrderRight do config
Aplicar grid-rows-${gridRows} dinamicamente
4.5.2 Settings/MatchTab

Adicionar seletor de número de jogadores (2, 3, 4, 5, 6)
Vincular ao preset apropriado
Mostrar preview do layout
5. Decisões Técnicas
DT-1: Estrutura de Configuração
Decisão: Usar objeto GameModeConfig aninhado com CourtLayoutConfig
Razão: Separação clara entre regras de pontuação e layout de quadra

DT-2: Identificação de Modos
Decisão: Manter GameModeType = 'indoor' | 'beach' | 'custom' + campo playersOnCourt
Razão: Compatibilidade com código existente que verifica mode === 'beach'

DT-3: Posições Vazias no Grid
Decisão: Usar -1 em arrays gridOrder para slots vazios
Razão: Simples de implementar, não requer mudança estrutural

DT-4: Rotações
Decisão: Manter lógica atual de rotação por array
Razão: Já funciona com qualquer tamanho de array (pop/unshift)

DT-5: Migração de Dados
Decisão: Fallback gracioso em LOAD_STATE para games salvos antigos
Razão: Mapear mode: 'indoor' para config completo automaticamente

DT-6: Validação
Decisão: Criar módulo src/utils/validation.ts separado
Razão: Reutilizável em múltiplos contextos (UI, state, rotação)

6. Riscos e Mitigações
Risco	Impacto	Mitigação
Games salvos incompatíveis	Alto	Fallback automático em LOAD_STATE
Layouts ímpares (3, 5)	Médio	Slots vazios com -1, CSS gracioso
Mudança de modo mid-match	Alto	Exigir reset, modal de confirmação
Confusão de zonas	Médio	Zona 1 sempre = sacador, consistente
Time incompleto	Médio	Validação bloqueia início de partida
Histórico com layout errado	Baixo	Salvar snapshot de modeConfig
7. Critérios de Aceite
 Seletor de modo 2v2, 3v3, 4v4, 5v5, 6v6 funcional em Settings
 Quadra visual adapta layout corretamente para cada modo
 Limite de jogadores em quadra respeita configuração
 Limite de reservas respeita configuração
 Rotações funcionam corretamente para todos os modos
 Substituições validam limites mínimos
 Games antigos carregam sem erro (backward compatibility)
 Build de produção passa sem erros
8. Próximos Passos
Aprovação deste PRD
Fase 1: Criar tipos e config de presets (não-destrutivo)
Fase 2: Refatorar constants.ts e rosterLogic.ts
Fase 3: Atualizar VolleyballCourt.tsx
Fase 4: Adicionar UI de seleção em Settings
Fase 5: Testes end-to-end de todos os modos